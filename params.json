{"name":"VT-Web JSON","tagline":"Ruby Wrapper for Veritrans VT-Web using JSON request","body":"# Veritrans VT-Web Ruby wrapper using JSON request\r\n\r\nRuby Wrapper for Veritrans VT-Web. Visit https://www.veritrans.co.id for more information about the product and see documentation at http://docs.veritrans.co.id/vtweb/index.html for more technical details.\r\n\r\n## Installation\r\n\r\nAdd this line to your application's Gemfile:\r\n\r\n    gem 'vtweb_json'\r\n\r\nAnd then execute:\r\n\r\n    $ bundle\r\n\r\nOr install it yourself as:\r\n\r\n    $ gem install vtweb_json\r\n\r\n## Usage\r\n\r\nIn your Rails app, create 'vtweb.yml' at config directory (config/vtweb.yml) with this code:\r\n\r\n    development:\r\n      merchant_id: \"T100000000000001XXXXXX\"\r\n      merchant_hash_key: \"yourmerchanthashkey\"\r\n      unfinish_payment_return_url: \"http://localhost:3000/cancel_pay\"\r\n      finish_payment_return_url: \"http://localhost:3000/finish\"\r\n      error_payment_return_url: \"http://localhost:3000/error\"\r\n      vtweb_server: \"http://127.0.0.1:4000\"\r\n\r\n    production:\r\n      merchant_id: \"A100000000000001XXXXXX\"\r\n      merchant_hash_key: \"yourmerchanthashkey\"\r\n      unfinish_payment_return_url: \"http://yourweb.com/canceled\"\r\n      finish_payment_return_url: \"http://yourweb.com/thank_you\"\r\n      error_payment_return_url: \"http://yourweb.com/shop_again\"\r\n      \r\nCreate a file in 'config/initializers' to set config to vtweb.yml, for example 'store_config.rb':\r\n    \r\n    raw_config = File.read(\"#{Rails.root}/config/vtweb.yml\")\r\n    CONFIG = YAML.load(raw_config)[Rails.env].symbolize_keys\r\n \r\n      \r\nIn your controller, create a method to use the gem. I took the code from https://github.com/veritrans/veritrans-rails-sample-cart for the example with some modification:\r\n\r\n    def confirm\r\n      client = ::VtwebJson::Client.new\r\n      client.order_id     = SecureRandom.hex(5)\r\n\r\n      # Example \r\n      @carts = Cart.all\r\n      @total = Cart.select(:sub_total).sum(:sub_total)\r\n  \r\n      params[\"item\"] = []    \r\n\r\n      @carts.each do |item|\r\n        params[\"item\"] << { \"item_id\" => item.product_id, \"price\" => item.product.price.to_s, \"quantity\" => item.quantity.to_s, \r\n                                  \"item_name1\" => item.product.name, \"item_name2\" => item.product.name }\r\n      end\r\n  \r\n      client.items    \t\t\t\t\t\t\t= params[\"item\"]\r\n      client.billing_different_with_shipping \t= 1\r\n      client.required_shipping_address \t\t\t= 1\r\n      client.first_name    \t\t\t\t\t\t= params[:first_name]\r\n      client.last_name     \t\t\t\t\t\t= params[:last_name]\r\n      client.address1      \t\t\t\t\t\t= params[:address1]\r\n      client.address2      \t\t\t\t\t\t= params[:address2]\r\n      client.city          \t\t\t\t\t\t= params[:city]\r\n      client.country_code  \t\t\t\t\t\t= params[:country_code]\r\n      client.postal_code   \t\t\t\t\t\t= params[:postal_code]\r\n      client.phone         \t\t\t\t\t\t= params[:phone]    \r\n      client.shipping_first_name    \t\t\t= params[:shipping_first_name]\r\n      client.shipping_last_name     \t\t\t= params[:shipping_last_name]\r\n      client.shipping_address1      \t\t\t= params[:shipping_address1]\r\n      client.shipping_address2      \t\t\t= params[:shipping_address2]\r\n      client.shipping_city          \t\t\t= params[:shipping_city]\r\n      client.shipping_country_code  \t\t\t= params[:shipping_country_code]\r\n      client.shipping_postal_code   \t\t\t= params[:shipping_postal_code]\r\n      client.shipping_phone         \t\t\t= params[:shipping_phone]  \r\n      client.email \t\t\t\t\t\t\t    = params[:email] \r\n  \r\n      # Payment Options\r\n      client.promo_bins             \t\t\t= ['411111', '510510']    \r\n      client.enable_3d_secure      \t\t\t\t= 1\r\n      client.installment_banks      \t\t\t= ['bni', 'cimb', 'mandiri']\r\n      client.installment_terms      \t\t\t= { bni: [3,12,2], cimb: [3,6,12] }\r\n      client.point_banks            \t\t\t= ['cimb', 'bni']\r\n      client.bank                   \t\t\t= 'bni'\r\n      client.payment_methods        \t\t\t= ['credit_card', 'mandiri_clickpay']\r\n\r\n      client.tokens\r\n      @client = client\r\n      @tokens = JSON.parse client.tokens.body\r\n      render :layout => 'application'\r\n    end\r\n    \r\nAfter you get token_browser and token_merchant, you have to send a http post request merchant_id, order_id and token_browser to redirection url of vtweb. This code was also taken from https://github.com/veritrans/veritrans-rails-sample-cart :\r\n\r\n    <h1 align=\"center\">Confirm Purchase Items</h1>\r\n    <%= form_tag(@client.redirection_url, :name => \"form_auto_post\") do -%>\r\n    \t<input type=\"hidden\" name=\"merchant_id\" value=\"<%= @client._merchant_id %>\"> \r\n    \t<input type=\"hidden\" name=\"order_id\" value=\"<%= @client.order_id %>\">\r\n    \t<input type=\"hidden\" name=\"token_browser\" value=\"<%= @tokens[\"token_browser\"] %>\">\r\n    \t<table border=\"1\" align=\"center\" width=\"80%\" cellpadding=\"10\" bgcolor=\"#FFFFCC\">\r\n      <tr>\r\n        <th>Name</th>\r\n        <th>Price</th>\r\n        <th>Quantity</th>\r\n        <th>Sub Total</th>    \r\n      </tr>\r\n      \r\n      <% for cart in @carts %>\r\n        <tr>\r\n          <td><%= cart.product.name %></td>\r\n          <td><%= cart.product.price %></td>\r\n          <td><%= cart.quantity %></td>\r\n          <td><%= cart.sub_total %></td>\r\n        </tr>    \r\n      <% end %>  \r\n      <tr>\r\n      \t<td colspan=\"2\"></td>\r\n      \t<td style=\"text-align=right\"><strong>Total</strong></td>\r\n      \t<td style=\"text-align=right\"><strong><%= @total %> </strong></td>\r\n      </tr>\r\n    \t</table>\r\n    \t<br><br>\r\n    \t<div align=\"center\">\r\n    \t<input type=\"submit\" value=\"Go to payment page\">\r\n    \t</div>\r\n    <% end %>\r\n\r\n## Contributing\r\n\r\n1. Fork it http://github.com/panggi/vtweb_json/fork \r\n2. Create your feature branch (`git checkout -b my-new-feature`)\r\n3. Commit your changes (`git commit -am 'Add some feature'`)\r\n4. Push to the branch (`git push origin my-new-feature`)\r\n5. Create new Pull Request\r\n","google":"UA-42012087-4","note":"Don't delete this file! It's used internally to help with page regeneration."}